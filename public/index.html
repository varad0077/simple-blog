<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Blog Website</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header>
    <nav>
      <div class="logo">Blog Space</div>
      <div class="nav-links">
        <a href="#" class="active">Home</a>
        <a href="#" id="newPostBtn">New Post</a>
        <button id="logoutBtn">Logout</button>
    </div>
    </nav>
  </header>

  <main>
    <div class="blog-container">
      <div id="postsList"></div>
    </div>

    <!-- New Post Modal -->
    <div id="newPostModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Create New Post</h2>
        <form id="newPostForm">
          <input type="text" id="postTitle" placeholder="Post Title" required>
          <select id="postCategory" required>
            <option value="">Select Category</option>
            <option value="Web Development">Web Development</option>
            <option value="Artificial Intelligence">Artificial Intelligence</option>
            <option value="DevOps">DevOps</option>
            <option value="Cloud Computing">Cloud Computing</option>
    </select>
          <textarea id="postContent" placeholder="Write your post content here..." required></textarea>
          <button type="submit">Publish Post</button>
        </form>
      </div>
  </div>

    <!-- Post Detail Modal -->
    <div id="postDetailModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="postDetail"></div>
        <div class="comments-section">
          <h3>Comments</h3>
          <div id="commentsList"></div>
          <form id="commentForm">
            <textarea id="commentText" placeholder="Write a comment..." required></textarea>
            <button type="submit">Post Comment</button>
          </form>
        </div>
      </div>
    </div>
  </main>

  <script>
    let currentPostId = null;
    const postsList = document.getElementById('postsList');
    const newPostModal = document.getElementById('newPostModal');
    const postDetailModal = document.getElementById('postDetailModal');
    const newPostBtn = document.getElementById('newPostBtn');
    const logoutBtn = document.getElementById('logoutBtn');

    // Load posts
    async function loadPosts() {
      try {
        const response = await fetch('/posts');
        const posts = await response.json();
        displayPosts(posts);
      } catch (error) {
        console.error('Error loading posts:', error);
      }
    }

    // Display posts
    function displayPosts(posts) {
      postsList.innerHTML = posts.map(post => `
        <div class="post-card" onclick="showPostDetail(${post.id})">
          <div class="post-header">
            <h2>${post.title}</h2>
            <span class="post-category">${post.category}</span>
          </div>
          <div class="post-content">
            <p class="post-excerpt">${post.content.substring(0, 150)}...</p>
          </div>
          <div class="post-footer">
            <div class="post-meta">
              <span class="author">ðŸ‘¤ ${post.author}</span>
              <span class="date">ðŸ“… ${post.date}</span>
            </div>
            <div class="post-stats">
              <span class="comments-count">ðŸ’¬ ${post.comments.length} comments</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Show post detail
    async function showPostDetail(postId) {
      currentPostId = postId;
      try {
        const response = await fetch(`/posts/${postId}`);
        const post = await response.json();
        
        document.getElementById('postDetail').innerHTML = `
          <div class="post-detail-header">
            <h2>${post.title}</h2>
            <div class="post-detail-meta">
              <span class="post-category">${post.category}</span>
              <div class="post-author-date">
                <span class="author">ðŸ‘¤ ${post.author}</span>
                <span class="date">ðŸ“… ${post.date}</span>
              </div>
            </div>
          </div>
          <div class="post-detail-content">
            ${post.content.split('\n').map(paragraph => `<p>${paragraph}</p>`).join('')}
          </div>
        `;

        document.getElementById('commentsList').innerHTML = post.comments.map(comment => `
          <div class="comment">
            <div class="comment-header">
              <span class="comment-author">ðŸ‘¤ ${comment.username}</span>
              <span class="comment-date">ðŸ“… ${comment.date}</span>
            </div>
            <p class="comment-content">${comment.comment}</p>
          </div>
        `).join('');

        postDetailModal.style.display = 'block';
      } catch (error) {
        console.error('Error loading post:', error);
      }
    }

    // Event Listeners
    newPostBtn.onclick = () => newPostModal.style.display = 'block';
    logoutBtn.onclick = async () => {
      try {
        await fetch('/logout', { method: 'POST' });
        window.location.href = '/';
      } catch (error) {
        console.error('Error logging out:', error);
      }
    };

    // Close modals
    document.querySelectorAll('.close').forEach(closeBtn => {
      closeBtn.onclick = function() {
        this.closest('.modal').style.display = 'none';
      }
    });

    // New post form submission
    document.getElementById('newPostForm').onsubmit = async (e) => {
      e.preventDefault();
      const post = {
        title: document.getElementById('postTitle').value,
        content: document.getElementById('postContent').value,
        category: document.getElementById('postCategory').value
      };

      try {
        const response = await fetch('/posts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(post)
        });
        
        if (response.ok) {
          newPostModal.style.display = 'none';
          loadPosts();
          e.target.reset();
        }
      } catch (error) {
        console.error('Error creating post:', error);
      }
    };

    // Comment form submission
    document.getElementById('commentForm').onsubmit = async (e) => {
      e.preventDefault();
      const comment = {
        comment: document.getElementById('commentText').value
      };

      try {
        const response = await fetch(`/posts/${currentPostId}/comments`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(comment)
        });
        
        if (response.ok) {
          showPostDetail(currentPostId);
          e.target.reset();
        }
      } catch (error) {
        console.error('Error posting comment:', error);
      }
    };

    // Initial load
    loadPosts();
  </script>

</body>
</html>
